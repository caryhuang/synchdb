--- oracle_parser17.ivy/ora_gram.y	2025-11-05 10:44:01.821874190 -0800
+++ oracle_parser17/ora_gram.y	2025-09-17 16:03:48.235143261 -0700
@@ -55,6 +55,7 @@
 #include "ora_gramparse.h"
 #include "nodes/makefuncs.h"
 #include "nodes/nodeFuncs.h"
+#include "nodes/nodetags_ext.h"
 #include "parser/parser.h"
 #include "parser/scansup.h"
 #include "storage/lmgr.h"
@@ -64,7 +65,16 @@
 #include "utils/numeric.h"
 #include "utils/ora_compatible.h"
 #include "utils/xml.h"
+#include "catalog/pg_attribute.h"
 
+/* static configuration to oracle parser */
+int compatible_db = ORA_PARSER;
+int nls_length_semantics = NLS_LENGTH_BYTE;
+bool identifier_case_from_pg_dump = false;
+bool enable_case_switch = true;
+bool enable_emptystring_to_NULL = false;
+bool enable_canonical_mode = true;
+int identifier_case_switch = INTERCHANGE;
 
 /*
  * Location tracking support --- simpler than bison's default, since we only
@@ -690,6 +700,9 @@
 					json_object_constructor_null_clause_opt
 					json_array_constructor_null_clause_opt
 
+/* added for synchdb to support notvalid without adding keyword */
+%type <ival> EnableOpts
+
 /*
  * Non-keyword token types.  These are hard-wired into the "flex" lexer.
  * They must be listed first so that their numeric codes do not depend on
@@ -2531,7 +2544,7 @@
 					n->def = $4;
 					$$ = (Node *) n;
 				}
-						/* ALTER TABLE <name> ALTER [COLUMN] <colname> DROP INVISIBLE */
+			/* ALTER TABLE <name> ALTER [COLUMN] <colname> DROP INVISIBLE */
 			| ALTER opt_column ColId DROP INVISIBLE
 				{
 					AlterTableCmd *n = makeNode(AlterTableCmd);
@@ -2547,20 +2560,105 @@
 					n->name = $3;
 					$$ = (Node *)n;
 				}
-			| MODIFY ColId INVISIBLE
+			| MODIFY ColId Typename opt_collate_clause alter_using
 				{
 					AlterTableCmd *n = makeNode(AlterTableCmd);
-					n->subtype = AT_SetInvisible;
+					ColumnDef *def = makeNode(ColumnDef);
+
+					n->subtype = AT_AlterColumnType;
 					n->name = $2;
-					$$ = (Node *)n;
+					n->def = (Node *) def;
+					/* We only use these fields of the ColumnDef node */
+					def->typeName = $3;
+					def->collClause = (CollateClause *) $4;
+					def->raw_default = $5;
+					//def->location = @3;
+					$$ = (Node *) n;
 				}
-			| MODIFY ColId VISIBLE
+			| MODIFY '(' ColId Typename opt_collate_clause alter_using ')'
 				{
 					AlterTableCmd *n = makeNode(AlterTableCmd);
-					n->subtype = AT_DropInvisible;
+					ColumnDef *def = makeNode(ColumnDef);
+
+					n->subtype = AT_AlterColumnType;
+					n->name = $3;
+					n->def = (Node *) def;
+					/* We only use these fields of the ColumnDef node */
+					def->typeName = $4;
+					def->collClause = (CollateClause *) $5;
+					def->raw_default = $6;
+					//def->location = @3;
+					$$ = (Node *) n;
+				}
+			| MODIFY ColId DEFAULT a_expr
+				{
+					AlterTableCmd *n = makeNode(AlterTableCmd);
+			        
+					n->subtype = AT_ColumnDefault;
 					n->name = $2;
-					$$ = (Node *)n;
+					n->def = (Node *) $4;   /* expression for the DEFAULT */
+					$$ = (Node *) n;
+				}
+			| MODIFY '(' ColId DEFAULT a_expr ')'
+				{
+					AlterTableCmd *n = makeNode(AlterTableCmd);
+
+					n->subtype = AT_ColumnDefault;
+					n->name = $3;
+					n->def = (Node *) $5;   /* expression for the DEFAULT */
+					$$ = (Node *) n;
 				}
+			| MODIFY ColId NOT NULL_P
+				{
+					AlterTableCmd *n = makeNode(AlterTableCmd);
+
+					n->subtype = AT_SetNotNull;
+					n->name = $2;
+					n->def = NULL;
+					$$ = (Node *) n;
+			    }
+			| MODIFY '(' ColId NOT NULL_P ')'
+                {
+					AlterTableCmd *n = makeNode(AlterTableCmd);
+
+					n->subtype = AT_SetNotNull;
+					n->name = $3;
+					n->def = NULL;
+					$$ = (Node *) n;
+                }
+			| MODIFY ColId NULL_P
+                {
+					AlterTableCmd *n = makeNode(AlterTableCmd);
+
+					n->subtype = AT_DropNotNull;
+					n->name = $2;
+					n->def = NULL;
+					$$ = (Node *) n;
+                }
+            | MODIFY '(' ColId NULL_P ')'
+                {
+					AlterTableCmd *n = makeNode(AlterTableCmd);
+
+					n->subtype = AT_DropNotNull;
+					n->name = $3;
+					n->def = NULL;
+					$$ = (Node *) n;
+                }
+
+			//| MODIFY ColId INVISIBLE
+			//	{
+			//		AlterTableCmd *n = makeNode(AlterTableCmd);
+			//		n->subtype = AT_SetInvisible;
+			//		n->name = $2;
+			//		$$ = (Node *)n;
+			//	}
+			//| MODIFY ColId VISIBLE
+			//	{
+			//		AlterTableCmd *n = makeNode(AlterTableCmd);
+			//		n->subtype = AT_DropInvisible;
+			//		n->name = $2;
+			//		$$ = (Node *)n;
+			//	}
 			/* ALTER TABLE <name> ALTER [COLUMN] <colname> DROP NOT NULL */
 			| ALTER opt_column ColId DROP NOT NULL_P
 				{
@@ -4168,6 +4266,17 @@
 					n->initially_valid = true;
 					$$ = (Node *) n;
 				}
+			/* added for synchdb */
+			| DEFAULT ON NULL_P b_expr
+				{
+					Constraint *n = makeNode(Constraint);
+
+                    n->contype = CONSTR_DEFAULT;
+                    n->location = @1;
+                    n->raw_expr = $4;
+                    n->cooked_expr = NULL;
+                    $$ = (Node *) n;
+				}
 			| DEFAULT b_expr
 				{
 					Constraint *n = makeNode(Constraint);
@@ -6405,6 +6514,22 @@
 				}
 		;
 
+/* added for synchdb as workaround - whatever token comes after ENABLE or DISABLE,
+ * we do nothing
+ */
+EnableOpts:
+			/* empty */			{ $$ = 0; }
+			| VALIDATE			{ $$ = 0; }
+    		| IDENT
+				{
+					if (pg_strcasecmp($1, "novalidate") == 0)
+						$$ = 0;
+					else
+						$$ = 0;
+					pfree($1);
+				}
+		;
+
 ConstraintAttributeElem:
 			NOT DEFERRABLE					{ $$ = CAS_NOT_DEFERRABLE; }
 			| DEFERRABLE					{ $$ = CAS_DEFERRABLE; }
@@ -6412,6 +6537,9 @@
 			| INITIALLY DEFERRED			{ $$ = CAS_INITIALLY_DEFERRED; }
 			| NOT VALID						{ $$ = CAS_NOT_VALID; }
 			| NO INHERIT					{ $$ = CAS_NO_INHERIT; }
+/* added for synchdb - just a workaround, it does not really supprot enabled or disabled constraint */
+			| DISABLE_P EnableOpts			{ $$ = 0; }
+			| ENABLE_P EnableOpts			{ $$ = 0; }
 		;
 
 
@@ -15380,7 +15508,10 @@
 						 */
 						if (n->val.ival.ival == (INTERVAL_MASK(YEAR) | INTERVAL_MASK(MONTH)))
 						{
-							$$ = OracleSystemTypeName("yminterval");
+							if (enable_canonical_mode)
+								$$ = OracleSystemTypeName("interval year to month");
+							else
+								$$ = OracleSystemTypeName("yminterval");
 							$$->typmods = $2;
 							$$->location = @1;
 						}
@@ -15389,7 +15520,10 @@
 													 INTERVAL_MASK(MINUTE) |
 													 INTERVAL_MASK(SECOND)))
 						{
-							$$ = OracleSystemTypeName("dsinterval");
+							if (enable_canonical_mode)
+								$$ = OracleSystemTypeName("interval day to second");
+							else
+								$$ = OracleSystemTypeName("dsinterval");
 							$$->typmods = $2;
 							$$->location = @1;
 						}
@@ -15696,30 +15830,39 @@
 				{
 					if (ORA_PARSER == compatible_db)
 					{
-						if (strcmp($1, "bpchar"))
+						if (enable_canonical_mode)
 						{
-							if (nls_length_semantics == NLS_LENGTH_CHAR)
-								$1 = "oravarcharchar";
-							else
-								$1 = "oravarcharbyte";
+							$$ = OracleSystemTypeName($1);
+							$$->typmods = list_make1(makeIntConst($3, @3));
+							$$->location = @1;
 						}
 						else
 						{
-							if ($3 > CHAR_TYPE_LENGTH_MAX)
-								ereport(ERROR,
-									(errcode(ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE),
-									errmsg("specified length too long for its datatype"),
-									parser_errposition(@3)));
-
-							if (nls_length_semantics == NLS_LENGTH_CHAR)
-								$1 = "oracharchar";
+							if (strcmp($1, "bpchar"))
+							{
+								if (nls_length_semantics == NLS_LENGTH_CHAR)
+									$1 = "oravarcharchar";
+								else
+									$1 = "oravarcharbyte";
+							}
 							else
-								$1 = "oracharbyte";
-						}
+							{
+								if ($3 > CHAR_TYPE_LENGTH_MAX)
+									ereport(ERROR,
+										(errcode(ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE),
+										errmsg("specified length too long for its datatype"),
+										parser_errposition(@3)));
+
+								if (nls_length_semantics == NLS_LENGTH_CHAR)
+									$1 = "oracharchar";
+								else
+									$1 = "oracharbyte";
+							}
 
-						$$ = OracleSystemTypeName($1);
-						$$->typmods = list_make1(makeIntConst($3, @3));
-						$$->location = @1;
+							$$ = OracleSystemTypeName($1);
+							$$->typmods = list_make1(makeIntConst($3, @3));
+							$$->location = @1;
+						}
 					}
 					else
 					{
@@ -15734,29 +15877,39 @@
 				{
 					if (ORA_PARSER == compatible_db)
 					{
-						if (!strcmp($1, "bpchar"))
+						/* changed for synchdb */
+						if (enable_canonical_mode)
 						{
-							if (nls_length_semantics == NLS_LENGTH_CHAR)
-								$1 = "oracharchar";
-							else
-								$1 = "oracharbyte";
+							$$ = OracleSystemTypeName($1);
+							$$->typmods = list_make1(makeIntConst(1, -1));
+							$$->location = @1;
 						}
 						else
 						{
-							if (nls_length_semantics == NLS_LENGTH_CHAR)
-								$1 = "oravarcharchar";
+							if (!strcmp($1, "bpchar"))
+							{
+								if (nls_length_semantics == NLS_LENGTH_CHAR)
+									$1 = "oracharchar";
+								else
+									$1 = "oracharbyte";
+							}
 							else
-								$1 = "oravarcharbyte";
-						}
-
-						$$ = OracleSystemTypeName($1);
-
-						if ((strcmp($1, "oracharchar") == 0) || (strcmp($1, "oracharbyte") == 0))
-							$$->typmods = list_make1(makeIntConst(1, -1));
-						else
-							$$->typmods = list_make1(makeIntConst(4000, -1));
+							{
+								if (nls_length_semantics == NLS_LENGTH_CHAR)
+									$1 = "oravarcharchar";
+								else
+									$1 = "oravarcharbyte";
+							}	
+	
+							$$ = OracleSystemTypeName($1);
+	
+							if ((strcmp($1, "oracharchar") == 0) || (strcmp($1, "oracharbyte") == 0))
+								$$->typmods = list_make1(makeIntConst(1, -1));
+							else
+								$$->typmods = list_make1(makeIntConst(4000, -1));
 
-						$$->location = @1;
+							$$->location = @1;
+						}
 					}
 					else
 					{
@@ -15769,21 +15922,22 @@
 				}
 		;
 
-character:	CHARACTER opt_varying
-										{ $$ = $2 ? "varchar": "bpchar"; }
-			| CHAR_P opt_varying
-										{ $$ = $2 ? "varchar": "bpchar"; }
-			| VARCHAR
-										{ $$ = "varchar"; }
-			| VARCHAR2
-										{ $$ = "varchar"; }
-			| NATIONAL CHARACTER opt_varying
-										{ $$ = $3 ? "varchar": "bpchar"; }
-			| NATIONAL CHAR_P opt_varying
-										{ $$ = $3 ? "varchar": "bpchar"; }
-			| NCHAR opt_varying
-										{ $$ = $2 ? "varchar": "bpchar"; }
-		;
+
+character:  CHARACTER opt_varying
+                                        { if (enable_canonical_mode){$$ = $2 ? "character varying": "character";} else {$$ = $2 ? "varchar": "bpchar";} }
+            | CHAR_P opt_varying
+                                        { if (enable_canonical_mode){$$ = $2 ? "char varying": "char";} else {$$ = $2 ? "varchar": "bpchar";} }
+            | VARCHAR
+                                        { $$ = "varchar"; }
+            | VARCHAR2
+                                        { if (enable_canonical_mode){$$ = "varchar2";} else {$$ = "varchar";} }
+            | NATIONAL CHARACTER opt_varying
+                                        { if (enable_canonical_mode){$$ = $3 ? "national character varying": "national character";} else {$$ = $3 ? "varchar": "bpchar";} }
+            | NATIONAL CHAR_P opt_varying
+                                        { if (enable_canonical_mode){$$ = $3 ? "national char varying": "national char";} else {$$ = $3 ? "varchar": "bpchar";} }
+            | NCHAR opt_varying
+                                        { if (enable_canonical_mode){$$ = $2 ? "nchar varying": "nchar";} else {$$ = $2 ? "varchar": "bpchar";} }
+        ;
 
 opt_varying:
 			VARYING									{ $$ = true; }
@@ -15792,22 +15946,26 @@
 
 OracleCharacter: character '(' Iconst CHAR_P ')'
 					{
-						if (strcmp($1, "bpchar"))
-							$1 = "oravarcharchar";
-						else
-							$1 = "oracharchar";
-
+						if (!enable_canonical_mode)
+						{
+							if (strcmp($1, "bpchar"))
+								$1 = "oravarcharchar";
+							else
+								$1 = "oracharchar";
+						}
 						$$ = OracleSystemTypeName($1);
 						$$->typmods = list_make1(makeIntConst($3, @3));
 						$$->location = @1;
 					}
 				| character '(' Iconst BYTE_P ')'
 					{
-						if (strcmp($1, "bpchar"))
-							$1 = "oravarcharbyte";
-						else
-							$1 = "oracharbyte";
-
+						if (!enable_canonical_mode)
+						{
+							if (strcmp($1, "bpchar"))
+								$1 = "oravarcharbyte";
+							else
+								$1 = "oracharbyte";
+						}
 						$$ = OracleSystemTypeName($1);
 						$$->typmods = list_make1(makeIntConst($3, @3));
 						$$->location = @1;
@@ -15823,10 +15981,20 @@
 				{
 					if (ORA_PARSER == compatible_db)
 					{
-						if ($5)
-							$$ = OracleSystemTypeName("oratimestamptz");
+						if (enable_canonical_mode)
+						{
+							if ($5)
+                                $$ = OracleSystemTypeName("timestamp with time zone");
+                            else
+                                $$ = OracleSystemTypeName("timestamp");
+						}
 						else
-							$$ = OracleSystemTypeName("oratimestamp");
+						{
+							if ($5)
+								$$ = OracleSystemTypeName("oratimestamptz");
+							else
+								$$ = OracleSystemTypeName("oratimestamp");
+						}
 						$$->typmods = list_make1(makeIntConst($3, @3));
 						$$->location = @1;
 					}
@@ -15844,10 +16012,20 @@
 				{
 					if (ORA_PARSER == compatible_db)
 					{
-						if ($2)
-							$$ = OracleSystemTypeName("oratimestamptz");
+						if (enable_canonical_mode)
+						{
+							if ($2)
+                                $$ = OracleSystemTypeName("timestamp with time zone");
+                            else
+                                $$ = OracleSystemTypeName("timestamp");
+						}
 						else
-							$$ = OracleSystemTypeName("oratimestamp");
+						{
+							if ($2)
+								$$ = OracleSystemTypeName("oratimestamptz");
+							else
+								$$ = OracleSystemTypeName("oratimestamp");
+						}
 						$$->typmods = list_make1(makeIntConst(6, -1));
 						$$->location = @1;
 					}
@@ -15862,13 +16040,19 @@
 				}
 			| TIMESTAMP WITH_LA LOCAL TIME ZONE
 				{
-					$$ = OracleSystemTypeName("oratimestampltz");
+					if (enable_canonical_mode)
+						$$ = OracleSystemTypeName("timestamp with local time zone");
+					else
+						$$ = OracleSystemTypeName("oratimestampltz");
 					$$->typmods = list_make1(makeIntConst(6, -1));
 					$$->location = @1;
 				}
 			| TIMESTAMP '(' Iconst ')' WITH_LA LOCAL TIME ZONE
 				{
-					$$ = OracleSystemTypeName("oratimestampltz");
+					if (enable_canonical_mode)
+						$$ = OracleSystemTypeName("timestamp with local time zone");
+					else
+						$$ = OracleSystemTypeName("oratimestampltz");
 					$$->typmods = list_make1(makeIntConst($3, @3));
 					$$->location = @1;
 				}
@@ -15876,7 +16060,10 @@
 				{
 					if (ORA_PARSER == compatible_db)
 					{
-						$$ = OracleSystemTypeName("oradate");
+						if (enable_canonical_mode)
+							$$ = OracleSystemTypeName("date");
+						else
+							$$ = OracleSystemTypeName("oradate");
 						$$->location = @1;
 					}
 					else
@@ -15909,7 +16096,10 @@
 		{
 			if (ORA_PARSER == compatible_db)
 			{
-				$$ = OracleSystemTypeName("oratimestamp");
+				if (enable_canonical_mode)
+					$$ = OracleSystemTypeName("timestamp");
+				else
+					$$ = OracleSystemTypeName("oratimestamp");
 				$$->typmods = list_make1(makeIntConst(6, -1));
 				$$->location = @1;
 			}
@@ -15918,7 +16108,10 @@
 		{
 			if (ORA_PARSER == compatible_db)
 			{
-				$$ = OracleSystemTypeName("oradate");
+				if (enable_canonical_mode)
+					$$ = OracleSystemTypeName("date");
+				else
+					$$ = OracleSystemTypeName("oradate");
 				$$->location = @1;
 			}
 		}
@@ -19450,7 +19643,10 @@
 							n->val.ival.ival == INTERVAL_MASK(MONTH) ||
 							n->val.ival.ival == (INTERVAL_MASK(YEAR) | INTERVAL_MASK(MONTH)))
 						{
-							t = OracleSystemTypeName("yminterval");
+							if (enable_canonical_mode)
+								t = OracleSystemTypeName("interval year to month");
+							else
+								t = OracleSystemTypeName("yminterval");
 							t->typmods = $3;
 							t->location = @1;
 
@@ -19458,7 +19654,10 @@
 						}
 						else
 						{
-							t = OracleSystemTypeName("dsinterval");
+							if (enable_canonical_mode)
+								t = OracleSystemTypeName("interval day to second");
+							else
+								t = OracleSystemTypeName("dsinterval");
 							t->typmods = $3;
 							t->location = @1;
 
@@ -21341,7 +21540,9 @@
 List *
 OracleSystemFuncName(char *name)
 {
-	return list_make2(makeString("sys"), makeString(name));
+	/* changed for synchdb */
+	//return list_make2(makeString("sys"), makeString(name));
+	return list_make1(makeString(name));
 }
 
 /* SystemTypeName()
@@ -21364,8 +21565,10 @@
 TypeName *
 OracleSystemTypeName(char *name)
 {
-	return makeTypeNameFromNameList(list_make2(makeString("sys"),
-											   makeString(name)));
+	/* changed for synchdb */
+	return makeTypeNameFromNameList(list_make1(makeString(name)));
+	//return makeTypeNameFromNameList(list_make2(makeString("sys"),
+	//										   makeString(name)));
 }
 
 /* doNegate()
